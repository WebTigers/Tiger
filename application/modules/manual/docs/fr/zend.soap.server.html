<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Zend_Soap_Server</title>
<link rel="stylesheet" type="text/css" href="dbstyle.css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.2">
<link rel="home" href="index.html" title="Guide de référence du programmeur">
<link rel="up" href="zend.soap.html" title="Zend_Soap">
<link rel="prev" href="zend.soap.html" title="Zend_Soap">
<link rel="next" href="zend.soap.client.html" title="Zend_Soap_Client">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Zend_Soap_Server</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.soap.html">Précédent</a> </td>
<th width="60%" align="center">Zend_Soap</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.soap.client.html">Suivant</a>
</td>
</tr>
</table></div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.soap.server"></a>Zend_Soap_Server</h2></div></div></div>
    

    <p>
        La classe <code class="classname">Zend_Soap_Server</code> a été créée pour simplifier la
        création d'un service Web <acronym class="acronym">SOAP</acronym> en <acronym class="acronym">PHP</acronym>.
    </p>

    <p>
        Elle peut être utilisée en mode WSDL ou non-WSDL, et elle utilise des fonctions ou des
        classes pour définir le service Web rendu.
    </p>

    <p>
        Lorsque le composant <code class="classname">Zend_Soap_Server</code> fonctionne en mode WSDL,
        il utilise le document WSDL pour décrire le comportement des objets du serveur ainsi que les
        options de transport vers les clients.
    </p>

    <p>
        Un document WSDL peut être auto-généré en utilisant <a class="link" href="zend.soap.autodiscovery.html#zend.soap.autodiscovery.introduction" title="Introduction à l'auto découverte">le composant Zend_Soap_AutoDiscovery</a>,
        ou alors construit manuellement avec <a class="link" href="zend.soap.wsdl.html" title="WSDL">la classe
        <code class="classname">Zend_Soap_Wsdl</code></a> ou tout autre outil de génération de <acronym class="acronym">XML</acronym>
    </p>

    <p>
        Si le mode non-WSDL est utilisé, alors toutes les options du protocole doivent être
        configurées.
    </p>

    <div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.soap.server.constructor"></a>Constructeur de <code class="classname">Zend_Soap_Server</code>
</h3></div></div></div>
        

        <p>
            Le constructeur de <code class="classname">Zend_Soap_Server</code> s'utilise différemment
            selon que l'on fonctionne en mode WSDL ou non.
        </p>

        <div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.soap.server.constructor.wsdl_mode"></a>Constructeur de <code class="classname">Zend_Soap_Server</code> en mode WSDL</h4></div></div></div>
            

            <p>
                Le constructeur de <code class="classname">Zend_Soap_Server</code> prend 2 paramètres
                optionnel en mode WSDL: </p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
                        <p>
                            <code class="varname">$wsdl</code>, l'URI permettant l'accès au fichier WSDL
                            <a href="#ftn.idm192780128640" class="footnote" name="idm192780128640"><sup class="footnote">[23]</sup></a>.
                            </p>
                    </li>
<li class="listitem">
                        <p>
                            <code class="varname">$options</code> - options de création des objets serveurs
                            <a href="#ftn.idm192780125696" class="footnote" name="idm192780125696"><sup class="footnote">[24]</sup></a>.
                            </p>

                        <p>
                            Les options suivantes sont reconnues en mode WSDL : </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
                                    <p>
                                        "soap_version" ("soapVersion") : version du protocole <acronym class="acronym">SOAP</acronym>
                                        à utiliser (SOAP_1_1 ou <acronym class="acronym">SOAP</acronym>_1_2).
                                    </p>
                                </li>
<li class="listitem">
                                    <p>"actor" : l'URI du serveur <acronym class="acronym">SOAP</acronym>.</p>
                                </li>
<li class="listitem">
                                    <p>
                                        "classmap" ("classMap") : utilisé pour faire correspondre
                                        des types WSDL à des classes <acronym class="acronym">PHP</acronym>.
                                    </p>

                                    <p>
                                        L'option doit être un tableau avec pour clés les types
                                        WSDL et pour valeur les classes <acronym class="acronym">PHP</acronym> correspondantes.
                                    </p>
                                </li>
<li class="listitem">
                                    <p>
                                        "encoding" : encodage interne des caractères (l'encodage
                                        externe est toujours UTF-8).
                                    </p>
                                </li>
<li class="listitem">
                                    <p>
                                        "wsdl" : équivalent à un appel à
                                        <code class="methodname">setWsdl($wsdlValue)</code>
                                    </p>
                                </li>
</ul></div>
<p>
                            </p>
                    </li>
</ol></div>
<p>
                </p>
        </div>

        <div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.soap.server.wsdl_mode"></a>Constructeur de <code class="classname">Zend_Soap_Server</code> en mode
            non-WSDL</h4></div></div></div>
            

            <p>
                Le premier paramètre du constructeur <span class="emphasis"><em>doit</em></span> être mis à la
                valeur <code class="constant">NULL</code> si vous voulez utiliser
                <code class="classname">Zend_Soap_Server</code> en mode non-WSDL.
            </p>

            <p>Vous devez aussi spécifier "uri" dans ce cas (voir juste après).</p>

            <p>
                Le second paramètre de constructeur est un tableau (<code class="varname">$options</code>)
                d'options permettant la création de l'objet serveur <acronym class="acronym">SOAP</acronym>.<a href="#ftn.idm192780109232" class="footnote" name="idm192780109232"><sup class="footnote">[25]</sup></a>.
                </p>

            <p>
                Les options suivantes sont reconnues en mode non-WSDL : </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
                        <p>
                            "soap_version" ("soapVersion") : version <acronym class="acronym">SOAP</acronym> à utiliser (SOAP_1_1
                            ou <acronym class="acronym">SOAP</acronym>_1_2).
                        </p>
                    </li>
<li class="listitem">
                        <p>"actor" : l'URI du serveur <acronym class="acronym">SOAP</acronym>.</p>
                    </li>
<li class="listitem">
                        <p>
                            "classmap" ("classMap") : utilisé pour faire correspondre des
                            types WSDL à des classes <acronym class="acronym">PHP</acronym>.
                        </p>

                        <p>
                            L'option doit être un tableau avec pour clés les types WSDL et
                            pour valeur les classes <acronym class="acronym">PHP</acronym> correspondantes.
                        </p>
                    </li>
<li class="listitem">
                        <p>
                            "encoding" : encodage interne des caractères (l'encodage externe
                            est toujours UTF-8).
                        </p>
                    </li>
<li class="listitem">
                        <p>
                            "wsdl" : équivalent à un appel à
                            <code class="code">setWsdl($wsdlValue).</code>
                        </p>
                    </li>
</ul></div>
<p>
                </p>
        </div>
    </div>

    <div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.soap.server.api_define_methods"></a>Méthodes de définitions de l'API du service</h3></div></div></div>
        

        <p>Il existe 2 manières de déclarer l'API de votre serveur <acronym class="acronym">SOAP</acronym>.</p>

        <p>
            La première consiste à attacher des classes à l'objet
            <code class="classname">Zend_Soap_Server</code>, celles-ci devront alors décrire l'API du
            service en totalité : </p>
<pre class="programlisting">
...
class MyClass {
    /**
     * Cette méthode accepte ...
     *
     * @param integer $inputParam
     * @return string
     */
    public function method1($inputParam) {
        ...
    }

    /**
     * Cette méthode accepte ...
     *
     * @param integer $inputParam1
     * @param string  $inputParam2
     * @return float
     */
    public function method2($inputParam1, $inputParam2) {
        ...
    }

    ...
}
...
$server = new Zend_Soap_Server(null, $options);
// Connecte la classe au serveur Soap
$server-&gt;setClass('MyClass');
// Connecte un objet déjà initialisé au serveur Soap
$server-&gt;setObject(new MyClass());
...
$server-&gt;handle();
</pre>
<p> </p>
<div class="note"><table border="0" summary="Note: Important!">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td>
<th align="left">Important!</th>
</tr>
<tr><td align="left" valign="top">
                    

                <p>
                    Vous devriez complètement décrire chaque méthode grâce aux blocs de
                    commentaires PHPDoc dans le cas où vous souhaitez utiliser l'auto découverte du
                    service pour préparer le WSDL correspondant.
                </p>
                </td></tr>
</table></div>
<p>
            </p>

        <p>
            La seconde manière de décrire l'API de votre service Web est d'utiliser des
            fonctions PHP conjointement avec les méthodes <code class="methodname">addFunction()</code> ou
            <code class="methodname">loadFunctions()</code> :</p>
<pre class="programlisting">
...
/**
 * Cette fonction ...
 *
 * @param integer $inputParam
 * @return string
 */
function function1($inputParam) {
    ...
}

/**
 * Cette fonction ...
 *
 * @param integer $inputParam1
 * @param string  $inputParam2
 * @return float
 */
function function2($inputParam1, $inputParam2) {
    ...
}
...
$server = new Zend_Soap_Server(null, $options);
$server-&gt;addFunction('function1');
$server-&gt;addFunction('function2');
...
$server-&gt;handle();
</pre>
        </div>

        <div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.soap.server.request_response"></a>Gestion des objets de requête et de réponse</h3></div></div></div>
            

            <div class="note"><table border="0" summary="Note: Avancée">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td>
<th align="left">Avancée</th>
</tr>
<tr><td align="left" valign="top">
                

            <p>
                Cette section décrit la gestion avancée des requêtes et réponses <acronym class="acronym">SOAP</acronym> et
                pourra être évitée.
            </p>
        </td></tr>
</table></div>

        <p>
            Le composant Zend_Soap_Server effectue des requêtes et récupère des réponses, ceci
            automatiquement. Il est possible d'intercepter la requête/réponse pour ajouter du pré ou
            post processus.
        </p>

        <div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.soap.server.request_response.request"></a>Requête</h4></div></div></div>
            

            <p>
                La méthode <code class="methodname">Zend_Soap_Server::handle()</code> utilise la
                requête depuis le flux d'entrée standard ('php://input'). Le comportement peut être
                changé en passant des paramètres à la méthode <code class="methodname">handle()</code> ou en spécifiant
                sa propre requête grâce à la méthode <code class="methodname">setRequest()</code> :</p>
<pre class="programlisting">
...
$server = new Zend_Soap_Server(...);
...
// Affecte une requête personnalisée
$server-&gt;handle($request);
...
// Affecte une requête personnalisée
$server-&gt;setRequest();
$server-&gt;handle();
</pre>

            <p>
                Un objet de requête peut être représenté de plusieurs manières différentes
                :</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
                            <p>DOMDocument (casté en <acronym class="acronym">XML</acronym>)</p>
                        </li>
<li class="listitem">
                        <p>
                            DOMNode (le DOMDocument attaché est extrait et casté en
                            <acronym class="acronym">XML</acronym>)
                        </p>
                    </li>
<li class="listitem">
                        <p>SimpleXMLElement (casté en <acronym class="acronym">XML</acronym>)</p>
                    </li>
<li class="listitem">
                        <p>
                            stdClass (__toString() est appelée et son contenu est vérifié
                            comme <acronym class="acronym">XML</acronym> valide)
                        </p>
                    </li>
<li class="listitem">
                        <p>chaînes de caractères (vérifiée comme <acronym class="acronym">XML</acronym> valide)</p>
                    </li>
</ul></div>
<p>
                </p>

            <p>
                La dernière requête utilisée et traitée peut être récupérée en utilisant la
                méthode <code class="methodname">getLastRequest()</code> :</p>
<pre class="programlisting">
...
$server = new Zend_Soap_Server(...);
...
$server-&gt;handle();
$request = $server-&gt;getLastRequest();
</pre>
            </div>

            <div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.soap.server.request_response.response"></a>Réponse</h4></div></div></div>
                

            <p>
                <code class="methodname">Zend_Soap_Server::handle()</code> émet automatiquement la
                réponse vers le flux standard de sortie. Ce comportement peut être changé en
                utilisant <code class="methodname">setReturnResponse()</code> avec une valeur <code class="constant">TRUE</code> ou
                <code class="constant">FALSE</code> en paramètre. <a href="#ftn.idm192780069376" class="footnote" name="idm192780069376"><sup class="footnote">[26]</sup></a>. La réponse générée par <code class="methodname">handle()</code> est alors retournée et
            non plus émise. </p>
<pre class="programlisting">
...
$server = new Zend_Soap_Server(...);
...
// Récupère la réponse plutôt que de l'émettre
$server-&gt;setReturnResponse(true);
...
$response = $server-&gt;handle();
...
</pre>

            <p>
                Autrement, la dernière réponse peut être récupérer avec la méthode
                <code class="methodname">getLastResponse()</code> :</p>
<pre class="programlisting">
...
$server = new Zend_Soap_Server(...);
...
$server-&gt;handle();
$response = $server-&gt;getLastResponse();
...
</pre>
            </div>
        </div>
    <div class="footnotes">
<br><hr style="width:100; text-align:left;margin-left: 0">
<div id="ftn.idm192780128640" class="footnote">
                                <p><a href="#idm192780128640" class="para"><sup class="para">[23] </sup></a>
                                    Peut être spécifié plus tard avec la méthode
                                    <code class="methodname">setWsdl($wsdl)</code>
                                </p>
                                </div>
<div id="ftn.idm192780125696" class="footnote">
                                <p><a href="#idm192780125696" class="para"><sup class="para">[24] </sup></a>
                                    Peut être spécifié plus tard avec la méthode
                                    <code class="methodname">setOptions($options)</code>
                                </p>
                                </div>
<div id="ftn.idm192780109232" class="footnote">
                    <p><a href="#idm192780109232" class="para"><sup class="para">[25] </sup></a>
                        Les options se configurent aussi plus tard, grâce à la méthode
                        <code class="methodname">setOptions($options)</code>
                    </p>
                    </div>
<div id="ftn.idm192780069376" class="footnote">
                    <p><a href="#idm192780069376" class="para"><sup class="para">[26] </sup></a>
                        L'état actuel du drapeau de retour de la réponse peut être vérifié via
                        la méthode <code class="methodname">setReturnResponse()</code> sans paramètre.
                    </p>
                </div>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.soap.html">Précédent</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.soap.html">Niveau supérieur</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.soap.client.html">Suivant</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Zend_Soap </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td>
<td width="40%" align="right" valign="top"> Zend_Soap_Client</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>

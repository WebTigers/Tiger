<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Zend_Service_WindowsAzure_Storage_Blob</title>
<link rel="stylesheet" type="text/css" href="dbstyle.css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.2">
<link rel="home" href="index.html" title="Programmer's Reference Guide">
<link rel="up" href="zend.service.html" title="Zend_Service">
<link rel="prev" href="zend.service.windowsazure.html" title="Zend_Service_WindowsAzure">
<link rel="next" href="zend.service.windowsazure.diagnostics.manager.html" title="Zend_Service_WindowsAzure_Diagnostics_Manager">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Zend_Service_WindowsAzure_Storage_Blob</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.service.windowsazure.html">Prev</a> </td>
<th width="60%" align="center">Zend_Service</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.service.windowsazure.diagnostics.manager.html">Next</a>
</td>
</tr>
</table></div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.service.windowsazure.storage.blob"></a>Zend_Service_WindowsAzure_Storage_Blob</h2></div></div></div>
    

    <p>
        Blob Storage stores sets of binary data. Blob storage offers the following three
        resources: the storage account, containers, and blobs.  Within your storage account,
        containers provide a way to organize sets of blobs within your storage account.
    </p>

    <p>
        Blob Storage is offered by Windows Azure as a <acronym class="acronym">REST</acronym> <acronym class="acronym">API</acronym>
        which is wrapped by the <code class="classname">Zend_Service_WindowsAzure_Storage_Blob</code> class
        in order to provide a native <acronym class="acronym">PHP</acronym> interface to the storage account.
    </p>

    <div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.windowsazure.storage.blob.api"></a>API Examples</h3></div></div></div>
        

        <p>
            This topic lists some examples of using the
            <code class="classname">Zend_Service_WindowsAzure_Storage_Blob</code> class.  Other features are
            available in the download package, as well as a detailed <acronym class="acronym">API</acronym>
            documentation of those features.
        </p>

        <div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.service.windowsazure.storage.blob.api.create-container"></a>Creating a storage container</h4></div></div></div>
            

            <p>
                Using the following code, a blob storage container can be created on development
                storage.
            </p>

            <div class="example">
<a name="zend.service.windowsazure.storage.blob.api.create-container.example"></a><p class="title"><b>Example 838. Creating a storage container</b></p>
<div class="example-contents">
                

                <pre class="programlisting">
$storageClient = new Zend_Service_WindowsAzure_Storage_Blob();
$result = $storageClient-&gt;createContainer('testcontainer');

echo 'Container name is: ' . $result-&gt;Name;
</pre>
            </div>
</div>
<br class="example-break">
        </div>

        <div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.service.windowsazure.storage.blob.api.delete-container"></a>Deleting a storage container</h4></div></div></div>
            

            <p>
                Using the following code, a blob storage container can be removed from development
                storage.
            </p>

            <div class="example">
<a name="zend.service.windowsazure.storage.blob.api.delete-container.example"></a><p class="title"><b>Example 839. Deleting a storage container</b></p>
<div class="example-contents">
                

                <pre class="programlisting">
$storageClient = new Zend_Service_WindowsAzure_Storage_Blob();
$storageClient-&gt;deleteContainer('testcontainer');
</pre>
            </div>
</div>
<br class="example-break">
        </div>

        <div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.service.windowsazure.storage.blob.api.storing-blob"></a>Storing a blob</h4></div></div></div>
            

            <p>
                Using the following code, a blob can be uploaded to a blob storage container on
                development storage. Note that the container has already been created before.
            </p>

            <div class="example">
<a name="zend.service.windowsazure.storage.blob.api.storing-blob.example"></a><p class="title"><b>Example 840. Storing a blob</b></p>
<div class="example-contents">
                

                <pre class="programlisting">
$storageClient = new Zend_Service_WindowsAzure_Storage_Blob();

// upload /home/maarten/example.txt to Azure
$result = $storageClient-&gt;putBlob(
    'testcontainer', 'example.txt', '/home/maarten/example.txt'
);

echo 'Blob name is: ' . $result-&gt;Name;
</pre>
            </div>
</div>
<br class="example-break">
        </div>

        <div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.service.windowsazure.storage.blob.api.copy-blob"></a>Copying a blob</h4></div></div></div>
            

            <p>
                Using the following code, a blob can be copied from inside the storage account. The
                advantage of using this method is that the copy operation occurs in the Azure cloud
                and does not involve downloading the blob. Note that the container has already been
                created before.
            </p>

            <div class="example">
<a name="zend.service.windowsazure.storage.blob.api.copy-blob.example"></a><p class="title"><b>Example 841. Copying a blob</b></p>
<div class="example-contents">
                

                <pre class="programlisting">
$storageClient = new Zend_Service_WindowsAzure_Storage_Blob();

// copy example.txt to example2.txt
$result = $storageClient-&gt;copyBlob(
    'testcontainer', 'example.txt', 'testcontainer', 'example2.txt'
);

echo 'Copied blob name is: ' . $result-&gt;Name;
</pre>
            </div>
</div>
<br class="example-break">
        </div>

        <div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.service.windowsazure.storage.blob.api.download-blob"></a>Downloading a blob</h4></div></div></div>
            

            <p>
                Using the following code, a blob can be downloaded from a blob storage container on
                development storage. Note that the container has already been created before and a
                blob has been uploaded.
            </p>

            <div class="example">
<a name="zend.service.windowsazure.storage.blob.api.download-blob.example"></a><p class="title"><b>Example 842. Downloading a blob</b></p>
<div class="example-contents">
                

                <pre class="programlisting">
$storageClient = new Zend_Service_WindowsAzure_Storage_Blob();

// download file to /home/maarten/example.txt
$storageClient-&gt;getBlob(
    'testcontainer', 'example.txt', '/home/maarten/example.txt'
);
</pre>
            </div>
</div>
<br class="example-break">
        </div>

        <div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.service.windowsazure.storage.blob.api.public-blob"></a>Making a blob publicly available</h4></div></div></div>
            

            <p>
                By default, blob storage containers on Windows Azure are protected from public
                viewing. If any user on the Internet should have access to a blob container, its ACL
                can be set to public. Note that this applies to a complete container and not to a
                single blob!
            </p>

            <p>
                Using the following code, blob storage container ACL can be set on development
                storage. Note that the container has already been created before.
            </p>

            <div class="example">
<a name="zend.service.windowsazure.storage.blob.api.public-blob.example"></a><p class="title"><b>Example 843. Making a blob publicly available</b></p>
<div class="example-contents">
                

                <pre class="programlisting">
$storageClient = new Zend_Service_WindowsAzure_Storage_Blob();

// make container publicly available (enumerate all blobs and read blob data)
$storageClient-&gt;setContainerAcl('testcontainer', Zend_Service_WindowsAzure_Storage_Blob::ACL_PUBLIC_CONTAINER);
</pre>
            </div>
</div>
<br class="example-break">
        </div>
    </div>

    <div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.windowsazure.storage.blob.root"></a>Root container</h3></div></div></div>
        

        <p>
            Windows Azure Blob Storage provides support to work with a "root container".
            This means that a blob can be stored in the root of your storage account,
            i.e. <code class="filename">http://myaccount.blob.core.windows.net/somefile.txt</code>.
        </p>

        <p>
            In order to work with the root container, it should first be created using the
            <code class="methodname">createContainer()</code> method, naming the container
            <code class="varname">$root</code>. All other operations on the root container should be issued
            with the container name set to <code class="varname">$root</code>.
        </p>
    </div>

    <div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.windowsazure.storage.blob.wrapper"></a>Blob storage stream wrapper</h3></div></div></div>
        

        <p>
            The Windows Azure <acronym class="acronym">SDK</acronym> for <acronym class="acronym">PHP</acronym> provides support
            for registering a blob storage client as a <acronym class="acronym">PHP</acronym> file stream wrapper.
            The blob storage stream wrapper provides support for using regular file operations on
            Windows Azure Blob Storage. For example, one can open a file from Windows Azure Blob
            Storage with the <code class="methodname">fopen()</code> function:
        </p>

        <div class="example">
<a name="zend.service.windowsazure.storage.blob.wrapper.sample"></a><p class="title"><b>Example 844. Example usage of blob storage stream wrapper</b></p>
<div class="example-contents">
            

            <pre class="programlisting">
$fileHandle = fopen('azure://mycontainer/myfile.txt', 'r');

// ...

fclose($fileHandle);
</pre>
        </div>
</div>
<br class="example-break">

        <p>
            In order to do this, the Windows Azure <acronym class="acronym">SDK</acronym> for <acronym class="acronym">PHP</acronym>
            blob storage client must be registered as a stream wrapper. This can be done by calling
            the <code class="methodname">registerStreamWrapper()</code> method:
        </p>

        <div class="example">
<a name="zend.service.windowsazure.storage.blob.wrapper.register"></a><p class="title"><b>Example 845. Registering the blob storage stream wrapper</b></p>
<div class="example-contents">
            

            <pre class="programlisting">
$storageClient = new Zend_Service_WindowsAzure_Storage_Blob();

// registers azure:// on this storage client
$storageClient-&gt;registerStreamWrapper();

// or:

// regiters blob:// on this storage client
$storageClient-&gt;registerStreamWrapper('blob://');
</pre>
        </div>
</div>
<br class="example-break">

        <p>
            To unregister the stream wrapper, the <code class="methodname">unregisterStreamWrapper()</code>
            method can be used.
        </p>
    </div>

    <div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.windowsazure.storage.blob.sharedaccesssig"></a>Shared Access Signature</h3></div></div></div>
        

        <p>
            Windows Azure Bob Storage provides a feature called "Shared Access Signatures". By
            default, there is only one level of authorization possible in Windows Azure Blob
            Storage: either a container is private or it is public. Shared Access Signatures provide
            a more granular method of authorization: read, write, delete and list permissions can be
            assigned on a container or a blob and given to a specific client using an URL-based
            model.
        </p>

        <p>
            An example would be the following signature:
        </p>

        <div class="literallayout"><p><br>
http://phpstorage.blob.core.windows.net/phpazuretestshared1?st=2009-08-17T09%3A06%3A17Z&amp;se=2009-08-17T09%3A56%3A17Z&amp;sr=c&amp;sp=w&amp;sig=hscQ7Su1nqd91OfMTwTkxabhJSaspx%2BD%2Fz8UqZAgn9s%3D<br>
        </p></div>

        <p>
            The above signature gives write access to the "phpazuretestshared1"
            container of the "phpstorage" account.
        </p>

        <div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.service.windowsazure.storage.blob.sharedaccesssig.generate"></a>Generating a Shared Access Signature</h4></div></div></div>
            

            <p>
                When you are the owner of a Windows Azure Bob Storage account, you can create and
                distribute a shared access key for any type of resource in your account. To do this,
                the <code class="methodname">generateSharedAccessUrl()</code> method of the
                <code class="classname">Zend_Service_WindowsAzure_Storage_Blob</code> storage client can be
                used.
            </p>

            <p>
                The following example code will generate a Shared Access Signature for write access
                in a container named "container1", within a timeframe of 3000 seconds.
            </p>

            <div class="example">
<a name="zend.service.windowsazure.storage.blob.sharedaccesssig.generate-2"></a><p class="title"><b>Example 846. Generating a Shared Access Signature for a container</b></p>
<div class="example-contents">
                

                <pre class="programlisting">
$storageClient   = new Zend_Service_WindowsAzure_Storage_Blob();
$sharedAccessUrl = $storageClient-&gt;generateSharedAccessUrl(
    'container1',
    '',
    'c',
    'w',
    $storageClient -&gt;isoDate(time() - 500),
    $storageClient -&gt;isoDate(time() + 3000)
);
</pre>
            </div>
</div>
<br class="example-break">

            <p>
                The following example code will generate a Shared Access Signature for read access
                in a blob named <code class="filename">test.txt</code> in a container named "container1"
                within a time frame of 3000 seconds.
            </p>

            <div class="example">
<a name="zend.service.windowsazure.storage.blob.sharedaccesssig-generate-3"></a><p class="title"><b>Example 847. Generating a Shared Access Signature for a blob</b></p>
<div class="example-contents">
                

                <pre class="programlisting">
$storageClient   = new Zend_Service_WindowsAzure_Storage_Blob();
$sharedAccessUrl = $storageClient-&gt;generateSharedAccessUrl(
    'container1',
    'test.txt',
    'b',
    'r',
    $storageClient -&gt;isoDate(time() - 500),
    $storageClient -&gt;isoDate(time() + 3000)
);
</pre>
            </div>
</div>
<br class="example-break">
        </div>

        <div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.service.windowsazure.storage.blob.sharedaccesssig.consume"></a>Working with Shared Access Signatures from others</h4></div></div></div>
            

            <p>
                When you receive a Shared Access Signature from someone else, you can use the
                Windows Azure <acronym class="acronym">SDK</acronym> for <acronym class="acronym">PHP</acronym> to work with the
                addressed resource. For example, the following signature can be retrieved from the
                owner of a storage account:
            </p>

            <div class="literallayout"><p><br>
http://phpstorage.blob.core.windows.net/phpazuretestshared1?st=2009-08-17T09%3A06%3A17Z&amp;se=2009-08-17T09%3A56%3A17Z&amp;sr=c&amp;sp=w&amp;sig=hscQ7Su1nqd91OfMTwTkxabhJSaspx%2BD%2Fz8UqZAgn9s%3D<br>
            </p></div>

            <p>
                The above signature gives write access to the "phpazuretestshared1" "container" of
                the phpstorage account. Since the shared key for the account is not known, the
                Shared Access Signature can be used to work with the authorized resource.
            </p>

            <div class="example">
<a name="zend.service.windowsazure.storage.blob.sharedaccesssig.consuming"></a><p class="title"><b>Example 848. Consuming a Shared Access Signature for a container</b></p>
<div class="example-contents">
                

                <pre class="programlisting">
$storageClient = new Zend_Service_WindowsAzure_Storage_Blob(
    'blob.core.windows.net', 'phpstorage', ''
);
$storageClient-&gt;setCredentials(
    new Zend_Service_WindowsAzure_Credentials_SharedAccessSignature()
);
$storageClient-&gt;getCredentials()-&gt;setPermissionSet(array(
    'http://phpstorage.blob.core.windows.net/phpazuretestshared1?st=2009-08-17T09%3A06%3A17Z&amp;se=2009-08-17T09%3A56%3A17Z&amp;sr=c&amp;sp=w&amp;sig=hscQ7Su1nqd91OfMTwTkxabhJSaspx%2BD%2Fz8UqZAgn9s%3D'
));
$storageClient-&gt;putBlob(
    'phpazuretestshared1', 'NewBlob.txt', 'C:\Files\dataforazure.txt'
);
</pre>
            </div>
</div>
<br class="example-break">

            <p>
                Note that there was no explicit permission to write to a specific blob. Instead, the
                Windows Azure <acronym class="acronym">SDK</acronym> for <acronym class="acronym">PHP</acronym> determined that a
                permission was required to either write to that specific blob, or to write to its
                container. Since only a signature was available for the latter, the Windows Azure
                <acronym class="acronym">SDK</acronym> for <acronym class="acronym">PHP</acronym> chose those credentials to perform
                the request on Windows Azure blob storage.
            </p>
        </div>
    </div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.service.windowsazure.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.service.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.service.windowsazure.diagnostics.manager.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Zend_Service_WindowsAzure </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Zend_Service_WindowsAzure_Diagnostics_Manager</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
